@model OnlineMCQ.ViewModels.StartTestViewModel
@{
    ViewData["Title"] = "Start Test";
}


<div class="container mt-5">
    <div class="card shadow-lg rounded-4">
        <div class="card-body mt-5">
            <h3 class="text-center text-primary mb-4">অনলাইন এমসিকিউ পরীক্ষা</h3>

            <div id="step1">
                <div class="mb-3">
                    <label>আপনার নাম</label>
                    <input type="text" id="name" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label>মোবাইল নম্বর</label>
                    <input type="text" id="contact" class="form-control" required />
                </div>
                <button class="btn btn-primary" onclick="goToStep2()">পরবর্তী</button>
                <a asp-action="Index" asp-controller="Home" class="btn btn-dark">Back to Home</a>
            </div>

            <form id="examForm" asp-action="SubmitTest" method="post" style="display:none;">
                <input type="hidden" name="name" id="hiddenName" />
                <input type="hidden" name="contact" id="hiddenContact" />

                <div id="timer" class="text-danger fw-bold fs-5 text-end mb-3"></div>

                @foreach (var question in Model.Questions)
                {
                    <div class="mb-4 border-bottom pb-3">
                        <h5>@question.QuestionText</h5>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="selectedAnswers[@question.QuestionId]" value="1" required>
                            <label class="form-check-label">@question.OptionA</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="selectedAnswers[@question.QuestionId]" value="2" required>
                            <label class="form-check-label">@question.OptionB</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="selectedAnswers[@question.QuestionId]" value="3" required>
                            <label class="form-check-label">@question.OptionC</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="selectedAnswers[@question.QuestionId]" value="4" required>
                            <label class="form-check-label">@question.OptionD</label>
                        </div>
                    </div>
                }

                <button type="submit" class="btn btn-success">পরীক্ষা জমা দিন</button>
                <a asp-action="Index" asp-controller="Home" class="btn btn-dark">Back to Home</a>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>

           let timeLeft = parseInt('@Model.ExamDuration') * 60;
        

            function goToStep2() {
            const name = document.getElementById("name").value;
            const contact = document.getElementById("contact").value;

            if (!name || !contact) {
                alert("নাম ও মোবাইল নম্বর পূরণ করুন!");
                return;
            }

            document.getElementById("step1").style.display = "none";
            document.getElementById("examForm").style.display = "block";
            document.getElementById("hiddenName").value = name;
            document.getElementById("hiddenContact").value = contact;

            startTimer();
        }

        function startTimer() {
            const timerElement = document.getElementById("timer");

            const countdown = setInterval(function () {
                let minutes = Math.floor(timeLeft / 60);
                let seconds = timeLeft % 60;
                timerElement.innerText = `সময় বাকি: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                timeLeft--;

                if (timeLeft < 0) {
                    clearInterval(countdown);
                    alert("সময় শেষ! ফলাফল দেখা হচ্ছে।");
                    document.getElementById("examForm").submit();
                }
            }, 1000);
        }
    </script>
}